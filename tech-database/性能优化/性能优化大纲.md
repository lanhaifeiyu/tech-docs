#### 凡事都有代价，做架构就是做取舍

追求：性能极致、开发效率、开发难度、可维护性、低资源占用



### 数据库性能优化

性能优化：运行环境优化（硬件、操作系统、MYSQL配置）、数据库整体设计、SQL优化

安全优化：程序运行权限、账号授权、数据权限、防止非法攻击（SQL注入等）、数据安全（防丢失、操作可追溯、备份容灾机制）

稳定性优化：高可用，热部署（热更新），性能平稳（高成功率、不产生非常大的波动）

资源占用优化（磁盘、内存、CPU、网络等）



### 性能优化

#### A、性能基准测试

性能测试：吞吐量，响应时间，并发性，可扩展性，稳定性

性能监控,explain, 慢日志, profile



#### B、运行环境优化

##### 一、服务器硬件优化

提升硬件：从机械硬盘升级到固态磁盘，性能更好的CPU，更大的内存，更高的网络带宽

##### 二、操作系统优化

提高资源占用率：尽量减少主机的其他程序对系统资源的占用（尽量让MySQL独占系统资源）

操作系统的选择，文件系统的选择

尽量避免使用 Swap

##### 三、MySQL自身的优化（配置调优）

```mysql
SHOW STATUS\G; 
show global status; 
show processlist;
SHOW VARIABLES LIKE '%table_size%';
SHOW status LIKE '%tmp%';
SHOW ENGINE INNODB STATUS;
-- information_schema表
-- performance_schema表
```



#### C、MySQL使用层面上的优化

##### 一、数据库设计

整体表项设计

表项之间的关联关系，表项的字段字义，存储引擎，范式，冗余，外键，索引

具体字段设计

是否使用：外键、视图、触发器、存储过程

##### 二、SQL语句优化

查询优化

数据量非常小（没上千）：一般不存在性能问题

###### 数据量大：

**用好索引**：覆盖索引、左前缀查询、避免索引失效（计算、类型转换等）

**减少磁盘扫描**：减少LEFT JOIN, 减少非索引字段排序，减少无用数据的查询，减少大偏移LIMIT，适当冗余数据

**减少额外负担**：外键约束、触发器、唯一索引、减少低效索引（）、避免无意义的高频连接（循环发SQL）、尽早提交事务

**冷热分离**，

**读写分离**，

**尽量小的数据类型**

###### 数据量巨大（上亿）：分库分表，水平拆分，垂直拆分

索引的带来的代价：



**写优化**：减少锁占用时间、有序加锁、索引外键触发器等会对写造成负担，避免过小事务和过大事务

读写优化：读写分离



##### 三、降低MySQL的访问压力

减少无用的读写访问

上层使用缓存等机制

数据实时性、数据一致性、缓存雪崩、缓存穿透、缓存击穿



--

找到性能问题：

整体把控：
查看MYSQL进程的CPU、内存、IO占用情况
通过命令查看MYSQL运行状态
通过脚本进行测试

具体问题：
explain, 慢日志, profile